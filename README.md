# linux_qq
运行于linux上命令行即时通讯程序

/*----------- 快速运行 -----------*/

1. 分别编译server和client, 编译命令均为make

2. 开启server, 命令 ./server

3. 开启client, 命令 ./client xx.xx.xx.xx
   
   xx.xx.xx.xx这个参数代表了server端的ip地址
   
4. 初次使用client端需要按照程序提示进行注册, 如果已注册过, 可以选择登录已有账号

5. 注册或登录成功后, 可以给同样处于登录状态的用户发送消息, 也可接受其它用户的消息
   假设有两个已登录用户, 用户名分别为: zfz 和 yx
   用户zfz给yx发送消息的命令是这样的 to:yx:消息内容,
   输入一条消息包含3部分,第一部分是"to",第二部分是"对方的用户名",第三部分是"消息内容",3部分用冒号连接
   (你可能觉得这样的固定输入格式会令输入过程变得不那么愉快,后续版本会改进输入格式)

/*----------- 程序结构 ------------*/

http://github.com/alwaysR9/linux_qq/raw/master/images/cxjg.png

1. 消息缓冲介于socket层和逻辑层中间, 它可以对逻辑层隐藏读写socket的细节, 使上层可以专注于逻辑的开发, 它包含读写两个缓冲

   读缓冲为它的使用者提供两个接口: 读取socket内容 和 弹出一个消息

   调用第一个接口,会一次性将socket中所有内容读取到读缓冲中;

   调用第二个接口,会从读缓冲中读取一个消息,并把这个消息从缓冲中移除.

   写缓冲也为它的使用者提供两个接口: 将一个消息写入到写缓冲中 和 把写缓冲内容全部写入socket中

   在Msg_buffer.h文件中声明了这4个接口, 有关接口的参数和返回值请查阅此文件.

   (这套接口独立于这个应用程序, 对于满足"消息长度+消息内容"两个域组成的消息, 这套接口具有通用性)

2. 消息 是client于server交流的接口, 程序里使用的消息遵循如下的格式:

   一条消息由两个域构成: 消息内容的长度 + 消息内容

   消息内容又包含四个域: 消息类型,发送方,接收方,消息数据

3. 服务器每提取出一条消息, 就把它交给消息处理过程来处理, 得到一条需要转发的消息和转发的socket, 并发送

/*------------ 已实现和不足 --------------*/

除[注册][登录][聊天]功能外, server和client端都可以应对接收到RST包的情况

不足包括: 

1. 客户端无法感知服务器断网, 服务器亦无法感知客户端断网

2. 如果用户将标准输入重定向为文件, 即可实现短期向服务器发送大量消息的情况, 对于这种情况暂时没有考虑

一定还有非常多的不足没有考虑到, 一旦我发现不足, 会及时更新


